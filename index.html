<!DOCTYPE HTML>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Timeline Realtime</title>
  <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
  <script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
  <style>
    #visualization { width: 100%; height: 400px; border: 1px solid lightgray; }
  </style>
</head>
<body>
  <div id="visualization"></div>

  <script>
    const socket = io("https://visjs-server.onrender.com");

    let items = new vis.DataSet();
    let container = document.getElementById("visualization");
    let options = { editable: true };
    let timeline = new vis.Timeline(container, items, options);

    // Ricevi eventi dal server
    socket.on("loadEvents", (events) => {
      items.clear();
      items.add(events);
    });

    // Invio modifiche al server
    function sendUpdate() {
      socket.emit("updateEvents", items.get());
    }

    // Listener per le modifiche
    timeline.on("add", function (event) {
      let newItem = event.item;
      newItem.content = prompt("Nome evento:", newItem.content) || "Nuovo evento";
      items.update(newItem);
      sendUpdate();
    });

    timeline.on("update", function (event) {
      let item = event.item;
      item.content = prompt("Modifica evento:", item.content) || item.content;
      items.update(item);
      sendUpdate();
    });

    timeline.on("remove", function (event) {
      if (confirm("Eliminare l'evento?")) {
        sendUpdate();
      } else {
        items.add(event.item);
      }
    });
  </script>
</body>
</html>
